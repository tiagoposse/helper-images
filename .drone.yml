---
kind: pipeline
type: kubernetes
name: cluster-droid

platform:
  os: linux
  arch: arm

steps:
- name: build
  image: registry.tiagoposse.com/kaniko-arm:1.2.0
  commands:
  - printf "`cat cluster-droid/VERSION`,latest" > .tags
  - /kaniko/executor --dockerfile=./cluster-droid/Dockerfile --context=cluster-droid  --cache=true --cache-repo=registry.tiagoposse.com/cluster-droid  --destination=registry.tiagoposse.com/cluster-droid  --build-arg=HELM_VERSION=3.4.2 --build-arg=KUBECTL_VERSION=1.18.10 --build-arg=VAULT_VERSION=1.6.1

trigger:
  paths:
  - cluster-droid/*

---
kind: pipeline
type: kubernetes
name: vault-agent

platform:
  os: linux
  arch: arm

steps:
- name: build
  image: registry.tiagoposse.com/kaniko-arm:1.2.0
  commands:
  - printf "`cat vault-agent/VERSION`,latest" > .tags
  - "/kaniko/executor --dockerfile=./vault-agent/Dockerfile --context=vault-agent  --cache=true --cache-repo=registry.tiagoposse.com/vault-agent  --destination=registry.tiagoposse.com/vault-agent "

trigger:
  paths:
  - vault-agent/*

---
kind: pipeline
type: kubernetes
name: zipalign

platform:
  os: linux
  arch: arm

steps:
- name: build
  image: registry.tiagoposse.com/kaniko-arm:1.2.0
  commands:
  - printf "`cat zipalign/VERSION`,latest" > .tags
  - "/kaniko/executor --dockerfile=./zipalign/Dockerfile --context=zipalign  --cache=true --cache-repo=registry.tiagoposse.com/zipalign  --destination=registry.tiagoposse.com/zipalign "

trigger:
  paths:
  - zipalign/*

---
kind: pipeline
type: kubernetes
name: kaniko-arm

platform:
  os: linux
  arch: arm

steps:
- name: build
  image: registry.tiagoposse.com/kaniko-arm:1.2.0
  commands:
  - printf "`cat kaniko-arm/VERSION`,latest" > .tags
  - "/kaniko/executor --dockerfile=./kaniko-arm/Dockerfile --context=kaniko-arm  --cache=true --cache-repo=registry.tiagoposse.com/kaniko-arm  --destination=registry.tiagoposse.com/kaniko-arm "

trigger:
  paths:
  - kaniko-arm/*

...
